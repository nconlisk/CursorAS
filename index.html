<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Among Us Task Simulator</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">AMONG US</h1>
            <h2 class="subtitle">TASK SIMULATOR</h2>
        </header>
        
        <main class="task-grid" id="taskGrid">
            <div class="task-category">
                <h3>ELECTRICAL</h3>
                <div class="task-buttons">
                    <button class="task-btn" data-task="fix-wiring">
                        <span class="task-icon">‚ö°</span>
                        <span class="task-name">Fix Wiring</span>
                    </button>
                    <button class="task-btn" data-task="calibrate-distributor">
                        <span class="task-icon">üîå</span>
                        <span class="task-name">Calibrate Distributor</span>
                    </button>
                    <button class="task-btn" data-task="divert-power">
                        <span class="task-icon">‚ö°</span>
                        <span class="task-name">Divert Power</span>
                    </button>
                </div>
            </div>

            <div class="task-category">
                <h3>NAVIGATION</h3>
                <div class="task-buttons">
                    <button class="task-btn" data-task="chart-course">
                        <span class="task-icon">üß≠</span>
                        <span class="task-name">Chart Course</span>
                    </button>
                    <button class="task-btn" data-task="stabilize-steering">
                        <span class="task-icon">üéØ</span>
                        <span class="task-name">Stabilize Steering</span>
                    </button>
                </div>
            </div>

            <div class="task-category">
                <h3>ENGINES</h3>
                <div class="task-buttons">
                    <button class="task-btn" data-task="align-engine">
                        <span class="task-icon">üîß</span>
                        <span class="task-name">Align Engine Output</span>
                    </button>
                    <button class="task-btn" data-task="fuel-engines">
                        <span class="task-icon">‚õΩ</span>
                        <span class="task-name">Fuel Engines</span>
                    </button>
                </div>
            </div>

            <div class="task-category">
                <h3>MEDICAL & SECURITY</h3>
                <div class="task-buttons">
                    <button class="task-btn" data-task="submit-scan">
                        <span class="task-icon">üîç</span>
                        <span class="task-name">Submit Scan</span>
                    </button>
                    <button class="task-btn" data-task="prime-shields">
                        <span class="task-icon">üõ°Ô∏è</span>
                        <span class="task-name">Prime Shields</span>
                    </button>
                </div>
            </div>

            <div class="task-category">
                <h3>MAINTENANCE</h3>
                <div class="task-buttons">
                    <button class="task-btn" data-task="clean-o2-filter">
                        <span class="task-icon">üå±</span>
                        <span class="task-name">Clean O2 Filter</span>
                    </button>
                    <button class="task-btn" data-task="empty-garbage">
                        <span class="task-icon">üóëÔ∏è</span>
                        <span class="task-name">Empty Garbage</span>
                    </button>
                    <button class="task-btn" data-task="swipe-card">
                        <span class="task-icon">üí≥</span>
                        <span class="task-name">Swipe Card</span>
                    </button>
                </div>
            </div>
        </main>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
            <span class="progress-text" id="progressText">0/10 Tasks Complete</span>
        </div>

        <button class="reset-btn" id="resetProgress">Reset All Tasks</button>
        
        <!-- Test button for debugging -->
        <button id="testBtn" style="margin: 10px; padding: 10px; background: #ff4757; color: white; border: none; border-radius: 5px; cursor: pointer;" onclick="console.log('Test button clicked!')">
            Test Button
        </button>
        
        <!-- Player Info Panel -->
        <div class="player-info" id="playerInfo" style="display: none;">
            <div class="player-id-display" id="playerIdDisplay"></div>
            <div class="player-role-display" id="playerRoleDisplay"></div>
        </div>
        
        <!-- Multiplayer Controls -->
        <div class="multiplayer-controls" id="multiplayerControls" style="display: none;">
            <button class="emergency-btn-main" id="emergencyMeetingMain">
                üö® EMERGENCY MEETING
            </button>
            <button class="setup-btn" onclick="window.location.href='player-setup.html'">
                ‚öôÔ∏è Game Setup
            </button>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script src="js/multiplayer.js"></script>
    <script>
        // Ensure TaskManager is properly initialized first
        let taskManagerInstance = null;
        
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize TaskManager if not already done
            if (document.querySelector('.task-grid') && !taskManagerInstance) {
                taskManagerInstance = new TaskManager();
                console.log('TaskManager initialized successfully');
            }
        });
        
        // Initialize multiplayer integration with timeout to ensure scripts are loaded
        setTimeout(() => {
            // Only run multiplayer code if multiplayerManager exists and is active
            if (window.multiplayerManager && window.multiplayerManager.getCurrentPlayer()) {
            // Check if player is logged in
            const currentPlayer = window.multiplayerManager.getCurrentPlayer();
            if (currentPlayer && window.multiplayerManager.isGameActive()) {
                // Show player info
                const playerInfo = document.getElementById('playerInfo');
                const playerIdDisplay = document.getElementById('playerIdDisplay');
                const playerRoleDisplay = document.getElementById('playerRoleDisplay');
                const multiplayerControls = document.getElementById('multiplayerControls');
                
                playerIdDisplay.textContent = `Player: ${currentPlayer.id}`;
                playerRoleDisplay.textContent = currentPlayer.role === 'impostor' ? 'üî¥ IMPOSTOR' : 'üë• CREWMATE';
                playerRoleDisplay.className = `player-role-display ${currentPlayer.role}`;
                
                playerInfo.style.display = 'block';
                multiplayerControls.style.display = 'block';
                
                // Hide/show tasks based on role
                if (currentPlayer.role === 'impostor') {
                    document.querySelectorAll('.task-btn').forEach(btn => {
                        btn.style.opacity = '0.5';
                        btn.style.pointerEvents = 'none';
                    });
                    
                    // Add impostor message
                    const impostorMessage = document.createElement('div');
                    impostorMessage.style.cssText = `
                        text-align: center;
                        color: #ff4757;
                        font-size: 1.2rem;
                        font-weight: bold;
                        margin: 20px 0;
                        padding: 15px;
                        background: rgba(255, 71, 87, 0.1);
                        border: 2px solid #ff4757;
                        border-radius: 10px;
                    `;
                    impostorMessage.textContent = 'You are the IMPOSTOR! Sabotage the crew and blend in.';
                    document.querySelector('.task-grid').prepend(impostorMessage);
                }
            } else {
                // Show setup button for game admin
                const setupBtn = document.createElement('button');
                setupBtn.textContent = 'üéÆ Start Multiplayer Game';
                setupBtn.className = 'setup-btn-main';
                setupBtn.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
                    border: none;
                    border-radius: 15px;
                    color: white;
                    font-family: 'Orbitron', monospace;
                    font-size: 1rem;
                    font-weight: 600;
                    padding: 15px 25px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    z-index: 1000;
                `;
                setupBtn.onclick = () => window.location.href = 'player-setup.html';
                document.body.appendChild(setupBtn);
            }
            
            // Emergency meeting button
            document.getElementById('emergencyMeetingMain')?.addEventListener('click', () => {
                window.multiplayerManager.callEmergencyMeeting(currentPlayer?.id);
            });
            } else {
                // No multiplayer session - ensure TaskManager is working properly
                console.log('No multiplayer session - TaskManager should be active');
                
                // Verify TaskManager is working
                if (window.taskManager) {
                    console.log('TaskManager is available and working');
                } else {
                    console.error('TaskManager not found - reinitializing');
                    if (document.querySelector('.task-grid')) {
                        window.taskManager = new TaskManager();
                    }
                }
            }
        });
        }, 200); // 200ms delay to ensure scripts are loaded
    </script>
</body>
</html>